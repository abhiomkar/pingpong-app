var Game=function(){var e={},t=$(window).width(),n=Math.min(650,$(window).height()-39),r={},i={},s=false,o,u=new Firebase("https://abhiomkar-pingpong.firebaseio.com/player"),a={},f,l,c={},h=false,p,d="bot",v={},m;v.left=0,v.right=0,e.game=o;c.mode="mouse";e.init=function(){console.log("Init");o=new Phaser.Game(t,n,Phaser.AUTO,"game_div",r)};r.preload=function(){o.stage.backgroundColor="#000";o.load.image("ball","assets/ball.png");o.load.image("paddle","assets/paddle.png")};r.create=function(){var e={font:"24px monospace",fontWeight:"300",fill:"#ffffff",align:"center"},r={font:"13px monospace",fontWeight:"300",fill:"#ffffff",align:"center"};o.physics.setBoundsToWorld(false,true,true,true);o.world.setBounds(20,0,t,n);o.physics.startSystem(Phaser.Physics.ARCADE);o.physics.arcade.checkCollision.left=false;o.physics.arcade.checkCollision.right=false;divider=new Phaser.Line(o.world.centerX,0,o.world.centerX,o.world.height);l=o.add.text(o.world.centerX,o.world.centerY,"Click to Play.",e);l.anchor.set(.5);m=o.add.text(o.world.centerX,10,"Score\n"+v.left+"         "+v.right,r);m.anchor.set(.5,0);a.left=o.add.sprite(40,o.world.centerY-40,"paddle");a.left.anchor.setTo(.5,.5);o.physics.enable(a.left,Phaser.Physics.ARCADE);a.left.body.velocity.x=0;a.left.body.immovable=true;a.left.body.collideWorldBounds=true;a.left.checkWorldBounds=true;a.right=o.add.sprite(o.world.width-20,o.world.centerY-40,"paddle");a.right.anchor.setTo(.5);o.physics.enable(a.right,Phaser.Physics.ARCADE);a.right.body.velocity.x=0;a.right.body.immovable=true;a.right.body.collideWorldBounds=true;a.right.checkWorldBounds=true;f=o.add.sprite(a.left.x+50,n/2,"ball");f.anchor.setTo(.5,.5);o.physics.enable(f,Phaser.Physics.ARCADE);f.checkWorldBounds=true;f.body.collideWorldBounds=true;f.body.bounce.set(1);f.events.onOutOfBounds.add(i.ballLost,this);o.input.onDown.add(i.releaseBall,this);p="left"};r.update=function(){var e={};if(!s){if(c.mode==="remote"){if(e.left!==c.left.acceleration){a.left.body.y+=c.left.acceleration*2}if(e.right!==c.right.acceleration){a.right.body.y+=c.right.acceleration*2}e.left=c.left.acceleration;e.right=c.right.acceleration}else if(c.mode==="mouse"){if(p==="left"){a.left.body.y=Math.min(o.input.y,o.height-a.left.height);if(d==="bot"){if(p==="left"){if(f.body.x>o.world.width/2){a.right.body.y=f.body.y}}else if(p==="right"){if(f.body.x>o.world.width/2){a.left.body.y=f.body.y}}}else{a.right.body.y=c.y||o.world.centerY-40;if(e.left!==o.input.y){}e.left=o.input.y}}else if(p==="right"){a.right.body.y=Math.min(o.input.y,o.height-a.right.height);if(d==="bot"){if(p==="left"){if(f.body.x>o.world.width/2){a.right.body.y=f.body.y}}else if(p==="right"){if(f.body.x>o.world.width/2){a.left.body.y=f.body.y}}}else{a.left.body.y=c.y||o.world.centerY-40;if(e.right!==o.input.y){u.child(p).update({y:a.right.body.y})}e.right=o.input.y}}}}o.physics.arcade.collide(f,a.left,i.ballHitPaddle,null,this);o.physics.arcade.collide(f,a.right,i.ballHitPaddle,null,this)};r.render=function(){o.debug.geom(divider)};e.renderScore=function(){m.text="Score\n"+v.left+"         "+v.right};i.ballLost=function(){f.body.velocity.x=0;f.body.velocity.y=0;s=true;l.text="Gamer Over!";l.visible=true;o.input.onDown.add(i.releaseBall,this)};i.releaseBall=function(){s=false;l.visible=false;f.reset(a.left.x+50,n/2);f.body.velocity.x=400;f.body.velocity.y=-400;f.animations.play("spin");o.input.onDown.removeAll();v.left=0;v.right=0;e.renderScore()};i.ballHitPaddle=function(t,n){var r=n.y-t.y;if(t.body.x<o.world.centerX){v.left+=1;if(r!==0){t.body.velocity.y=-4*r;t.body.velocity.x+=t.body.velocity.x*r*.005}else{t.body.velocity.y+=2+Math.random()*8}}else{v.right+=1;if(r!==0){t.body.velocity.y=-4*r}else{t.body.velocity.y+=2+Math.random()*8}}e.renderScore()};return e}();Game.init()